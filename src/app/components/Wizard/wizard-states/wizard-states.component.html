<div class="container py-3">
	<!-- Step Indicator -->
	<h4 translate class="mb-3">Create States Template</h4>
	<div class="d-flex align-items-center gap-2 mb-3">
		<div
			[class]="'badge rounded-pill ' + (step === 1 ? 'bg-primary' : 'bg-secondary')">1</div>
		<div translate [class.fw-bold]="step === 1">Header</div>
		<div class="mx-2">→</div>
		<div
			[class]="'badge rounded-pill ' + (step === 2 ? 'bg-primary' : 'bg-secondary')">2</div>
		<div translate [class.fw-bold]="step === 2">Details</div>
	</div>

	<!-- Server Message -->
	<div *ngIf="serverMessage" class="alert"
		[ngClass]="{'alert-success': serverMessage.type === 'success','alert-danger': serverMessage.type === 'error'}">{{
		serverMessage.text }}</div>

	<!-- Step Forms -->
	<!-- Step 1: Header Form -->
	<form *ngIf="step === 1" [formGroup]="headerForm" (ngSubmit)="submitHeader()"
		class="card p-3">
		<div class="mb-3">
			<label translate class="form-label">Template name</label>
			<input type="text" class="form-control" formControlName="nombre" [placeholder]="'Eg: Status flow for tasks' | translate" />
			<div translate class="text-danger small" *ngIf="headerForm.get('nombre')?.touched && headerForm.get('nombre')?.errors?.['required']">
				Name is required.
			</div>
			<div translate class="text-danger small" *ngIf="headerForm.get('nombre')?.touched && headerForm.get('nombre')?.errors?.['maxlength']">
				Maximum 15 characters allowed.
			</div>
		</div>
		<div class="d-flex justify-content-end gap-2">
			<button translate type="button" class="btn btn-danger" (click)="cancelWizard()">Cancel</button>
			<button translate type="submit" class="btn btn-primary">Keep</button>
		</div>
	</form>

	<!-- Step 2: Details Form -->
	<div *ngIf="step === 2" class="card p-3">
		<div class="d-flex justify-content-between align-items-center mb-2">
			<h6 class="m-0">States</h6>
			<div class="d-flex gap-2">
				<button translate class="btn btn-secondary"
					(click)="backToHeader()">Return</button>
				<button translate class="btn btn-primary" (click)="addDetail()">Add
					State</button>

			</div>
		</div>

		<div class="list-group mb-3" *ngIf="detailsFormArray.length > 0">
			<div class="list-group-item" *ngFor="let g of detailsControls; let i = index"
				[formGroup]="g">
				<div class="row g-2 align-items-end">
					
					<div class="col-2 d-flex gap-1 align-items-center justify-content-start">
						<label class="form-label">Nombre</label>
						<button type="button" class="btn btn-light" title="Subir"
							(click)="moveDetailUp(i)" [disabled]="i === 0">
							↑
						</button>
						<button type="button" class="btn btn-light" title="Bajar"
							(click)="moveDetailDown(i)"
							[disabled]="i === detailsFormArray.length - 1">
							↓
						</button>
					</div>
					<div class="col-5">
						<label class="form-label">Nombre</label>
						<input class="form-control" formControlName="nombre"
							placeholder="Ej: Nuevo, En progreso, Hecho" />
						<div class="text-danger small"
							*ngIf="g.get('nombre')?.touched && g.get('nombre')?.invalid">
							Requerido.
						</div>
					</div>
					<div class="col-3">
						<label class="form-label">Color</label>
						<input class="form-control" formControlName="color" type="color" />
					</div>
					<div class="col-2 d-flex justify-content-end">
						<button type="button" class="btn btn-danger" title="Eliminar"
							(click)="removeDetail(i)"><i class="bi bi-trash3-fill"></i></button>
					</div>
				</div>
			</div>
		</div>

		<div class="d-flex justify-content-end">
							<button translate class="btn btn-danger"
					(click)="cancelWizard()">Cancel</button>
			<button class="btn btn-primary" (click)="saveDetails()"
				[disabled]="isSubmittingDetails">
				{{ isSubmittingDetails ? 'Guardando…' : 'Guardar todo' }}
			</button>
		</div>
	</div>
</div>
